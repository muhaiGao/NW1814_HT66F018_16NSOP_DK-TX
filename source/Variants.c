#include "MyDefine.h"
/***************************************************************************
命名规范:
1.位变量
 f_Xx_Yx
2.变量
 1)
 字节变量:R_XxYy
 全局变量:gR_XxYy
 双字节变量命名:R_intXxYy
 四字节变量命名:R_longXxYy
 中断局部变量:isrR_XxYy

 2).变量只是备份
 R_XxYy_Copy

3.注释风格
 位置:在函数的前面或右边
 内容:语言统一，尽量清晰
4.程序可读性与可维护性
 程序中的语句、标号、变量使用小写英文字母（一般第一个字母需要大写），
 常量与预编译命令使用大写英文字母，以便和一般的语句进行区分。
 例如：
 C_NUMBER EQU 055H
 R_lackWater DB 2 DUP (?)

***************************************************************************/
//--2---- 外部全局位变量声明 -----------------------
volatile __flag_type  _flag0;
volatile __flag_type  _flag1;
volatile __flag_type  _TimeFlag0;
volatile __flag_type  _LedFlag;
volatile __flag_type  _display_data1;
volatile __flag_type  _display_data2;
volatile __flag_type  _display_data3;
////////
u8 	R_WorkMode/*,prev_mode*/;	

//LED
u8 	R_LedMode;		      //LED 显示模式.
u8 	R_LedDirFlag;           //呼吸灯亮灭方向标志
u8 	R_LedDutyCycle;         //用于存放占空比

//Temperature
u16  R_intTempDisplayLevel;//显示温度,控制按一定的相隔时间显示到设置的温度.
//==============Timing==================//
u8 	R_Time50msCount; //时间计数器
u8 	R_Time100msCount;//时间计数器
u8 	R_Time150msCount;//时间计数器
u8 	R_Time700msCount;//时间计数器
u16 R_intTime1sCount;//时间计数器
u8 	R_Time2sCount;   //时间计数器
u16 R_intHeatingPWM2ms;

//Resistance AD Seting Temp value display.
u16	R_intResAD_Value,R_intResAD_ValueBak;
u16	R_intRESTempSet,R_intRESTempSetCopy;//设置的温度值.
u8	R_UpdateTempSetCount;//是否需要更新设置温度值的记数.
u8 	R_Low60Count;
u8 	R_ResADCount;
u8 	R_ModeChgCount;//是否需要更新到加热模式.
u8 	R_TimeResTempSetDisplay;//设置温度的显示时间,超过此时间变成显示当前温度.

//Battery AD 
u16 R_intBatADValue;
u8 	R_BatLevel_Count0;
u8 	R_BatLevel_Count1;
u8 	R_BatLevel_Count2;
u8 	R_BatLevel_Count3;
//R_BatLevel:实际电池电压等级,R_BatLevelUp:控制显示电池电压按顺序0~R_BatLevel.
u8 	R_BatLevel,R_BatLevelUp;
u8 	R_Time2Min_BTLow;//电量低计时变量,2min钟后进入休眠状态.

//NTC AD
//u8 R_NTCTempCECount;//为了避免实时显示的温度值上下波动的显示问题.
u8 	R_NoNTCCount;
u16 R_intNTC_ADVal;
u8 	R_NTC_AD_Count;
u16 R_intNTC_CurrentTemp;//NTC 当前温度值.

u8 	R_PowerInCount;
u8 	R_DigitalTubeDisplayLoop;//循环显示数码管每一段的计数:a,b,c,d,e,f,g.
u8 	led_display_data1,led_display_data2,led_display_data3;
const u8 Table_DigitalTube[13]={0x3f,0X06,0X5b,0X4F,0X66,0X6D,0X7D,0X07,0X7F,0X6F,
                                          // 0    1    2    3    4    5    6    7    8    9 
                                           0X40,0x79,0x00
                                          // -   E   无显示
                                          };



#if 0
//插充电器,电源电压(V): 样机T507=> 9.3V~12.5V
//const u16 Table_BatChargeLevel[BAT_CHGLVL_MAX+1]={
//	1775,//6.5V
//	2540,//9.3V
//	2785,//10.2V
//	2840,//10.4V
//	2895,//10.6V
//	2949,//10.8V
//	3058,//11.2V
//	3140,//11.5V
//	3222,//11.8V
//	3304,//12.1V
//	3413,//12.5V
//	3413 //12.5V
//};
//没插充电器,电池电压(V):样机T507=> 9.3V~11.9V
const u16 Table_BatChargeLevel[BAT_CHGLVL_MAX+1]={
//	2540,//9.3V
	1775,//6.5V
	2785,//10.2V
	2840,//10.4V
	2895,//10.6V
	2949,//10.8V
	3031,//11.1V
	3086,//11.3V
	3140,//11.5V
	3168,//11.6V
	3249,//11.9V
	3249 //11.9V
};

#else

#if 0
//插充电器,电源电压(V):
const u16 Table_BatChargeLevel[BAT_CHGLVL_MAX+1]={
//	2540,//9.3V
	1775,//1.  6.5V
	2840,//2.  10.4V
	2895,//3.  10.6V
	2949,//4.  10.8V
	3004,//5.  11.0V
	3085,//6.  11.3V
 	3168,//7.  11.6V
	3245,//8.  11.85V
 	3359,//9.  12.3V
	3447,//10. 12.62V  3441  实测:12.70
	3454 //    12.72V  3441
};

//没插充电器,电池电压(V):
const u16 Table_BatLevel[BAT_LVL_MAX+1]={
	2512,//1.  9.2V
	2758,//2.  10.1V
	2813,//3.  10.3V
	2867,//4.  10.5V
	2922,//5.  10.7V
	3004,//6.  11.0V
 	3086,//7.  11.3V
  	3168,//8.  11.6V
 	3277,//9.  12.0V   
	3406,//10. 12.46v 实测:12.55
	3433 //    12.56V 
};
#endif
//插充电器,电源电压(V):
const u16 Table_BatChargeLevel[BAT_CHGLVL_MAX+1]={
//	2540,//9.3V
//	1775,//1.  6.5V
	2048,//1.  7.5V
	2813,//2.  10.3V
	2895,//3.  10.6V
	2949,//4.  10.8V
	3004,//5.  11.0V
	3085,//6.  11.3V
 	3168,//7.  11.6V
	3245,//8.  11.85V
 	3359,//9.  12.3V
	3436,//10.  V 实测:
	3441 //    12.64V
//	3435,//10.  
//	3448 //     
};

//没插充电器,电池电压(V):
const u16 Table_BatLevel[BAT_LVL_MAX+1]={
	2512,//1.  9.2V
	2731,//2.  10.0V
	2813,//3.  10.3V
	2867,//4.  10.5V
	2922,//5.  10.7V
	3004,//6.  11.0V
 	3086,//7.  11.3V
  	3168,//8.  11.6V
 	3277,//9.  12.0V 
	3386,//10. 12.4v 实测:
	3413 //    V 
//	3394,//10. 12.42v 实测:
//	3394 //    12.54V 
};

#endif

const u16 Table_ResData[TABLE_RES_MAX]={
/*200, 	219,	238,*//*257*/RES_AD_MIN,  /*276,*/ 	295, 	314, 	333,	352, 	371,
390, 	409,	428,	447,	466, 	485, 	504, 	523,	542, 	561,
580, 	599,	618,	637,	656, 	675, 	694, 	713,	732, 	751,
770, 	789,	808,	827,	846, 	865, 	884, 	903,	922, 	941,
960, 	979,	998,	1017,	1036,	1055,	1074,	1093,	1112,	1131,
1150,	1169,	1188,	1207,	1226,	1245,	1264,	1283,	1302,	1321,
1340,	1359,	1378,	1397,	1416,	1435,	1454,	1473,	1492,	1511,
1530,	1549,	1568,	1587,	1606,	1625,	1644,	1663,	1682,	1701,
1720,	1739,	1758,	1777,	1796,	1815,	1834,	1853,	1872,	1891,
1910,	1929,	1948,	1967,	1986,	2005,	2024,	2043,	2062,	2081,
2100,	2119,	2138,	2157,	2176,	2195,	2214,	2233,	2252,	2271,
2290,	2309,	2328,	2347,	2366,	2385,	2404,	2423,	2442,	2461,
2480,	2499,	2518,	2537,	2556,	2575,	2594,	2613,	2632,	2651,
2670,	2689,	2708,	2727,	2746,	2765,	2784,	2803,	2822,	2841,
2860,	2879,	2898,	2917,	2936,	2955,	2974,	2993,	3012,	3031,
3050,	3069,	3088,	3107,	3126,	3145,	3164,	3183,	3202,	3221,
3240,	3259,	3278,	3297,	3316,	3335,	3354,	3373,	3392,	3411,
3430,	3449,	3468,	3487,	3506,	3525,	3544,	3563,	3582,	3601,
3620,	3639,	3658,	3677,	3696,	3715,	3734,	3753,	3772,	3791,
3810,	3829,	3848,	3867,	3886,	3905,	3924,	3943,	3962,	3981,
4000,	4019,	4038,	4057,
/*4076*/RES_AD_MAX,
4097/*保留调整,现在这种查询方式(for循环)必须保留这位,否则调节温度到260档位会出现问题*/
};

#if 0
const u16 Table_NTC_Data[TABLE_NTC_MAX]={
		/*10摄氏度到59摄氏度没用到,只是平均填数字,后期考虑去掉(0-59:4001-3508)*/
/*10*/ /*4001,	3991,	3981,	3971,	3961,	3951,	3940,	3930,	3920,	3910,*/
/*20*/ /*3900,	3890,	3880,	3870,	3860,	3850,	3840,	3830,	3820,	3810,*/
/*30*/ /*3800,	3790,	3780,	3770,	3760,	3750,	3740,	3730,	3720,	3710,*/
/*40*/ /*3700,	3690,	3680,	3670,	3660,	3650,	3640,	3630,	3620,	3610,*/
/*50*/ 3600,	3590,	3580,	3569,	3559,	3549,	3539,	3538,	3537,	3536,//3508
/*60*/ 3482,	3472,	3465,	3449,	3432,	3416,	3400,	3383,	3367,	3351,  //16.38 
/*70*/ 3344,	3329,	3313,	3287,	3272,	3256,	3241,	3225,	3210,	3194,  //15.56 
/*80*/ 3156,	3145,	3133,	3110,	3087,	3064,	3041,	3018,	2995,	2972,  //22.94 
/*90*/ 2949,	2916,	2884,	2851,	2818,	2785,	2753,	2720,	2687,	2654,  //32.77 
/*100*/2644,	2634,	2611,	2582,	2569,	2556,	2543,	2530,	2517,	2503,  //13.11 
/*110*/2460,	2441,	2431,	2402,	2372,	2343,	2313,	2284,	2254,	2225,  //29.49 
/*120*/2195,	2179,	2163,	2146,	2130,	2114,	2097,	2081,	2064,	2048,  //16.38 
/*130*/2012,	2000,	1986,	1963,	1940,	1917,	1894,	1871,	1848,	1825,  //22.94 
/*140*/1802,	1778,	1753,	1729,	1704,	1679,	1655,	1630,	1606,	1581,  //24.58 
/*150*/1556,	1538,	1519,	1500,	1481,	1462,	1443,	1425,	1406,	1387,  //18.84 
/*160*/1368,	1352,	1337,	1321,	1306,	1290,	1275,	1259,	1244,	1228,  //15.56 
/*170*/1212,	1194,	1176,	1158,	1140,	1122,	1104,	1086,	1068,	1050,  //18.02 
/*180*/1032,	1019,	1006,	993 ,	980 ,	967 ,	954 ,	940 ,	927 ,	914 ,  //13.11 
/*190*/901,	    895,	888,	881,	875,	868,	862,	855,	849,	840,   //6.55 
/*200*/808,	    798,	790,	784,	780,	766,	752,	738,	724,	710,   //13.93 
/*210*/696,	    690,	684,	677,	671,	665,	658,	652,	646,	640,   //6.55
/*220*/631, 	624, 	618, 	611, 	605, 	598, 	591, 	585, 	578, 	572,   //6.55
/*230*/565, 	560, 	555, 	551, 	546, 	541, 	536, 	531, 	526, 	521,   //4.92
/*240*/516, 	510, 	505, 	499, 	493, 	487, 	482, 	476, 	470, 	464,   //5.73
/*250*/458,	    457, 	456, 	455, 	454, 	453, 	452, 	451, 	450, 	449,   //2.05
/*260*/446,																		       
/*保留*/	443,//用作调整 211
/*保留*/430,//用作调整 212
};
#else
//温度测试基本可以
//调整.
const u16 Table_NTC_Data[TABLE_NTC_MAX]={
/*10摄氏度到59摄氏度没用到,只是平均填数字,后期考虑去掉(0-59:4001-3508)*/
/*10*/ 4001,	3991,	3981,	3971,	3961,	3951,	3940,	3930,	3920,	3910,
/*20*/ 3900,	3890,	3880,	3870,	3860,	3850,	3840,	3830,	3820,	3810,
/*30*/ 3800,	3790,	3780,	3770,	3760,	3750,	3740,	3730,	3720,	3710,
/*40*/ 3700,	3690,	3680,	3670,	3660,	3650,	3640,	3630,	3620,	3610,
/*50*/ 3600,	3590,	3580,	3570,	3560,	3550,	3540,	3530,	3520,	3510,//3508
/*60*/ 3400,	3383,	3365,	3348,	3330,	3313,	3295,	3278,	3260,	3243,	
/*70*/ 3225,	3210,	3195,	3181,	3166,	3151,	3136,	3121,	3107,	3092,	
/*80*/ 3077,	3058,	3038,	3019,	3000,	2981,	2961,	2942,	2923,	2903,	
/*90*/ 2884,	2860,	2836,	2812,	2788,	2764,	2740,	2716,	2692,	2668,	
/*100*/2644,	2623,	2601,	2580,	2559,	2538,	2516,	2495,	2474,	2452,	
/*110*/2431,	2406,	2380,	2355,	2329,	2304,	2279,	2253,	2228,	2202,	
/*120*/2177,	2157,	2137,	2117,	2097,	2077,	2056,	2036,	2016,	1996,	
/*130*/1976,	1952,	1927,	1903,	1878,	1854,	1829,	1805,	1780,	1756,	
/*140*/1731,	1706,	1681,	1656,	1631,	1606,	1581,	1556,	1531,	1506,	
/*150*/1481,	1469,	1458,	1446,	1435,	1423,	1411,	1400,	1388,	1377,	
/*160*/1365,	1353,	1341,	1329,	1317,	1306,	1294,	1282,	1270,	1258,	
/*170*/1246,	1229,	1212,	1196,	1179,	1162,	1145,	1128,	1112,	1095,	
/*180*/1078,	1063,	1047,	1032,	1017,	1002,	986 ,	971 ,	956 ,	940 ,	
/*190*/925, 	918,	910,	903,	895,	888,	880,	873,	865,	858,
/*200*/850, 	840,	830,	820,	810,	800,	790,	780,	770,	760,
/*210*/750, 	743,	735,	728,	720,	713,	705,	698,	690,	683,
/*220*/675, 	671,	666,	662,	657,	653,	648,	644,	639,	635,
/*230*/630, 	625,	620,	615,	610,	605,	600,	595,	590,	585,
/*240*/580, 	577,	573,	570,	566,	563,	559,	556,	552,	549,
/*250*/545, 	542,	538,	535,	531,	528,	524,	521,	517,	514,
/*260*/510, 													
/*保留*/	505,//用作调整
/*保留*/500//用作调整
};
#endif

#if 1
//调整.
const u16 Table_HeatingTimeData[26]={
	500,//保留
	460,//保留
	440,//60//11.2V电池电压实际测试数据.60(455)~190(50).
	430,//70
	410,//80
	405,//90
	380,//100
	365,//110
	350,//120
	340,//130
	320,//140
	300,//150
	270,//160
	250,//170
	230,//180
	210,//190
	190,//200
	170,//210
	160,//220
	110,//230
	90,//240
	60,//250
	20,//260
	10,//保留
	5,//保留
	0,//保留
};
#else
//测量结果
const u16 Table_HeatingTimeData[25]={
	500,//保留
	480,//保留
	460,//455,//60//11.2V电池电压实际测试数据.60(455)~190(50).
	450,//435,//70
	440,//410,//80
	425,//385,//90
	410,//360,//100
	395,//330,//110
	380,//315,//120
	365,//295,//130
	340,//270,//140
	320,//240,//150
	300,//200,//160
	280,//150,//170
	260,//115,//180
	240,//50,//190
	220,//200
	200,//210
	180,//220
	120,//230
	80,//240
	60,//250
	10,//260
	1,//保留
	0,//保留
};
#endif
